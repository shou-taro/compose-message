# CLI 仕様 (git-compose)

このドキュメントでは、`git compose` コマンド群の挙動と仕様について説明します。

> git-compose は **自動でコミットを行いません**。  
> ステージ済み差分から「下書き」を生成し、最終判断は常にユーザーに委ねます。


## コマンド一覧

- `git compose init`  
  初期設定ウィザードを起動します。

- `git compose draft`  
  ステージ済み差分からコミットメッセージの下書きを生成します。


## `git compose init`

コミットメッセージ生成に関する設定を、対話形式で行います。

```bash
git compose init
```

### 挙動

- 対話形式のセットアップウィザードを起動します。
- 何度でも再実行可能です (設定の上書き)。
- デフォルトでは **グローバル設定** として保存されます。

### 設定項目

ウィザードでは以下の項目を順に設定します。

- 使用言語 (ja / en)
- LLM プロバイダ (現在は Ollama のみ)
- 使用するモデル
- デフォルトアクション
- Conventional Commits の使用有無
- Scope の扱い方
  - 自動検出 (auto)
  - 使用しない (omit)
- 差分サイズの上限
- 使用するエディタ

### ローカル設定

リポジトリ単位で設定したい場合は、`--local` オプションを使用します。

```bash
git compose init --local
```

この場合、設定はリポジトリ配下に保存され、  
グローバル設定よりも優先されます。


## `git compose draft`

ステージ済みの差分から、構造化されたコミットメッセージの下書きを生成します。

```bash
git compose draft
```

### 入力

- `git compose draft` は **Git リポジトリ内でのみ実行可能** です。
- `git add` によって **ステージされた差分** を入力として使用します。
- ステージ済みの差分が存在しない場合、下書きは生成されません。

### 出力

- コミットメッセージの下書きを標準出力に表示します。
- 出力は **必ず以下の構造** を持ちます。
  - 件名 (絵文字付き)
  - 空行
  - 本文ヘッダ行 (`Changes:` または `変更内容:`)
  - 箇条書きの本文 (最低 1 項目)
- 出力は **プレーンテキスト** です (Markdown ではありません)。


## 対話的フロー

`draft` コマンドは、以下の対話的フローで進行します。

```
1. 🧠 Generate
2. 👀 Preview
3. 📝 Edit / 🔁 Regenerate
4. ✅ Commit (optional)
```

- プレビューを確認し、必要に応じて編集や再生成が可能です。
- コミットは **必須ではありません**。


## Next step (次の操作)

プレビュー後、次の操作を選択できます。

### Exit (コミットしない)

Exit を選択した場合：

- コミットは実行されません。
- 下書きは保存されません。

表示されるメッセージ：

```
🚪 Exited without committing.
You can run this command again when you're ready.
```

### Commit (コミットする)

Commit を選択した場合、git-compose は生成された下書きを用いて **即座にコミットを実行**します。

- 内部的には `git commit -F <message-file>` を使用します。
- Git のコミットエディタは起動しません。
- コミットメッセージは、事前に生成・確認された内容がそのまま使用されます。

git-compose は、コミット内容の最終決定には関与しません。
