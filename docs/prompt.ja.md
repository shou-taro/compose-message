# プロンプト仕様 (git-compose)

このドキュメントでは、git-compose がコミットメッセージの下書きを生成する際に使用する **プロンプトおよび出力フォーマットの仕様** について説明します。

本仕様は、LLM の種類に依存しない **出力契約 (contract)** として定義されます。


## 基本方針

- git-compose は **構造化されたコミットメッセージ** を必ず生成します。
- 出力フォーマットはユーザー設定やプロバイダに関わらず、一貫した構造を持ちます。


## 出力全体の構造

生成されるコミットメッセージは、必ず以下の構造を持ちます。

```
<subject line>

<body header>
- <bullet item 1>
- <bullet item 2>
...
```

### 構造上の制約

- 件名と本文の間には **必ず 1 行の空行** が入ります。
- 本文は **必ず箇条書き** で構成されます。
- 箇条書きは **最低 1 項目以上** 生成されます。
- 出力は **プレーンテキスト** であり、Markdown ではありません。


## 件名 (Subject line)

### 必須要件

- 件名の先頭には **絵文字が必ず含まれます**。
- 件名は **1 行のみ** で構成されます。
- 改行文字を含んではいけません。
- 件名の長さは **72 文字以内** とします。


### Conventional Commits 有効時

Conventional Commits が有効な場合、件名は次の形式になります。

```
<emoji> <type>(<scope>): <summary>
```

- `<type>` は Conventional Commits の type (例: `feat`, `fix`)
- `<scope>` は設定に応じて自動推定または省略されます
- `<summary>` は変更内容を簡潔に表現した短文です

### Conventional Commits 無効時

Conventional Commits が無効な場合でも、**日本語・英語ともに共通の形式** で、内部的に **type を含む件名** が生成されます。  
件名は、次の形式になります。

```
<emoji> <type>: <summary>
```

- `<type>` は変更内容を表す簡潔な分類（例: `feat`, `fix`）
- `<summary>` は変更内容を簡潔に表現した短文です

この挙動は、**言語設定 (`ja` / `en`) に依存せず共通** であり、プロンプト仕様として固定されています。


## 本文ヘッダ (Body header)

### 必須要件

本文の最初の行には、**必ずヘッダ行** が入ります。

- 日本語の場合:  
  ```
  変更内容:
  ```
- 英語の場合:  
  ```
  Changes:
  ```

このヘッダ行は、省略できません。


## 本文 (Body)

### 必須要件

- 本文は、本文ヘッダの直後から始まります。
- 各行は `- ` (ハイフン＋半角スペース) で始まる必要があります。
- 各箇条書きは **1 つの変更点** を表します。

### 内容に関する指針

- ステージ済み差分に基づいた内容であること
- 実装・挙動・構造などの「変更点」を明示すること
- 冗長な背景説明や感想は含めないこと


## 言語切り替え

生成される文言は、設定された言語に従って切り替わります。

| 設定言語 | 本文ヘッダ |
| :-: | :-- |
| `ja` | `変更内容:` |
| `en` | `Changes:` |

件名および本文の自然言語表現も、選択された言語に従います。


## 禁止事項

以下の内容は、生成結果に **含めてはいけません**。

- Markdown 記法 (`*`, `**`, ```` ``` ```` など)
- 空の本文
- 箇条書きでない本文
- LLM に関する説明文や注意書き
- 「以下は変更内容です」などの前置き文


## 位置づけ

- 本仕様は **ユーザー向けドキュメント**であると同時に、**実装とテストの契約書**として機能します。
- 実装変更により出力フォーマットが変わる場合は、必ず本ドキュメントを更新してください。
